stages:
  - build
  - test
  - lint

default:
  image: ubuntu:22.04

build:
  stage: build
  before_script:
    - apt-get update -y
    - apt-get install -y cmake build-essential
  script:
    - mkdir build
    - cd build
    - cmake ..
    - cmake --build .
  artifacts:
    paths:
    - build/
    expire_in: 1 hour
  tags: 
    - student-code
test:
  stage: test
  needs: ["build"]
  before_script:
    - apt-get update -y
    - apt-get install -y cmake
  script:
  - cd build
  - ctest --output-on-failure
  tags: 
    - student-code

lint:
  stage: lint
  before_script:
    - apt-get update -y
    - apt-get install -y clang-tidy
  script:
    - clang-tidy $(find . -name "*.cpp" -or -name "*.c") -- -I.
  tags: 
    - student-code  